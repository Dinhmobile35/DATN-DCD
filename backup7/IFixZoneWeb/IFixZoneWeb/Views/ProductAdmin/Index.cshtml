@model IEnumerable<IFixZoneWeb.Models.Entities.Product>

@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Quản lý sản phẩm";
}

<h4 class="fw-bold mb-3">
    <i class="fa-solid fa-box"></i> Quản lý sản phẩm
</h4>

<div class="d-flex justify-content-between mb-3">
    <form class="row g-2" method="get">
        <div class="col-md-6">
            <input name="q" value="@ViewBag.Query" class="form-control" placeholder="Tìm sản phẩm..." />
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100">
                <i class="fa-solid fa-magnifying-glass"></i> Tìm kiếm
            </button>
        </div>
    </form>
    <a class="btn btn-success" asp-action="Edit">
        <i class="fa-solid fa-plus"></i> Thêm sản phẩm
    </a>
</div>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th width="90">Ảnh</th>
                <th>Tên</th>
                <th width="120">Giá</th>
                <th width="90">Tồn kho</th>
                <th width="250" class="text-center">Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var p in Model)
            {
                <tr>
                    <td>
                        @if (!string.IsNullOrEmpty(p.MainImage))
                        {
                            <img src="~/images/products/@p.MainImage" width="70" class="rounded" />
                        }
                        else
                        {
                            <span class="text-muted">—</span>
                        }
                    </td>
                    <td>@p.ProductName</td>
                    <td>@p.Price.ToString("N0") đ</td>
                    <td>
                        @if (p.Stock == 0)
                        {
                            <span class="badge bg-danger">Hết</span>
                        }
                        else
                        {
                            <span class="badge bg-success">@p.Stock</span>
                        }
                    </td>
                    <td class="text-center">
                        <a class="btn btn-sm btn-info" asp-action="Details" asp-route-id="@p.ProductId">
                            <i class="fa-solid fa-eye"></i> Xem
                        </a>
                        <a class="btn btn-sm btn-warning" asp-action="Edit" asp-route-id="@p.ProductId">
                            <i class="fa-solid fa-pen"></i> Sửa
                        </a>
                        <a class="btn btn-sm btn-primary" asp-action="ManageSpecifications" asp-route-productId="@p.ProductId">
                            <i class="fa-solid fa-list-ul"></i> Thông số (@p.ProductSpecifications.Count)
                        </a>
                        <form asp-action="Delete" asp-route-id="@p.ProductId" method="post" class="d-inline" onsubmit="return confirm('Bạn có chắc chắn xóa?');">
                            <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fa-solid fa-trash"></i> Xóa
                            </button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Phân trang -->
@{
    var page = (int)ViewBag.Page;
    var size = (int)ViewBag.PageSize;
    var total = (int)ViewBag.Total;
    var pages = (int)Math.Ceiling(total / (double)size);
}
@if (pages > 1)
{
    <nav>
        <ul class="pagination justify-content-center">
            @for (int i = 1; i <= pages; i++)
            {
                <li class="page-item @(i == page ? "active" : "")">
                    <a class="page-link" href="?page=@i&q=@ViewBag.Query">@i</a>
                </li>
            }
        </ul>
    </nav>
}