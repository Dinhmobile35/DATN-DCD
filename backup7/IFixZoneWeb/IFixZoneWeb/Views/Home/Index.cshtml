@using IFixZoneWeb.Models.Entities
@{
    var categories = ViewBag.Categories as List<Category> ?? new();
    var newProducts = ViewBag.NewProducts as List<Product> ?? new();
    var recommended = ViewBag.Recommended as List<Product> ?? new();
}

<style>
    /* ================= TOP WRAPPER ================= */
    .top-wrapper {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 16px;
        background: #fff;
        border-radius: 14px;
        padding: 12px;
        border: 1px solid #eee;
        margin-bottom: 24px;
    }

    @@media (max-width: 992px) {
        .top-wrapper {
            grid-template-columns: 1fr;
        }
    }

    /* ================= SIDEBAR CATEGORY ================= */
    .sidebar {
        border-radius: 12px;
        overflow: hidden;
    }

    .category-menu {
        list-style: none;
        padding: 0;
        margin: 0;
    }

        .category-menu li {
            border-bottom: 1px solid #f1f1f1;
        }

        .category-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            color: #111;
            font-size: 15px;
            font-weight: 500;
            text-decoration: none;
            transition: .25s;
        }

            .category-menu a i.icon {
                width: 22px;
                text-align: center;
                font-size: 16px;
                color: #6b7280;
            }

            .category-menu a i.arrow {
                margin-left: auto;
                color: #9ca3af;
            }

            .category-menu a:hover {
                background: #f5f7fa;
                color: #d70018;
            }

                .category-menu a:hover i {
                    color: #d70018;
                }

    /* ================= BANNER ================= */
    .banner-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 12px;
    }

    @@media (max-width: 768px) {
        .banner-grid {
            grid-template-columns: 1fr;
        }
    }

    .banner-main,
    .banner-side {
        border-radius: 12px;
        overflow: hidden;
    }

        .banner-main img,
        .banner-side img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    /* ================= SECTION ================= */
    .section-title {
        font-size: 22px;
        font-weight: 800;
        margin: 32px 0 16px;
        border-left: 5px solid #d70018;
        padding-left: 12px;
    }

    /* ================= FILTER ================= */
    .filter-tags {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
    }

        .filter-tags span {
            padding: 6px 12px;
            border-radius: 8px;
            background: #f1f3f5;
            cursor: pointer;
            font-size: 13px;
        }

            .filter-tags span.active,
            .filter-tags span:hover {
                background: #d70018;
                color: #fff;
            }

    /* ================= PRODUCT ================= */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(5,1fr);
        gap: 16px;
    }

    @@media (max-width:1200px) {
        .product-grid {
            grid-template-columns: repeat(4,1fr);
        }
    }

    @@media (max-width:768px) {
        .product-grid {
            grid-template-columns: repeat(2,1fr);
        }
    }

    .product-card {
        background: #fff;
        border-radius: 14px;
        border: 1px solid #eee;
        padding: 12px;
        transition: .25s;
    }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(0,0,0,.12);
        }

        .product-card img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: contain;
        }

    .product-title {
        font-size: 14px;
        font-weight: 600;
        margin: 10px 0;
        height: 40px;
        overflow: hidden;
    }

    .price {
        color: #d70018;
        font-size: 18px;
        font-weight: 800;
    }
</style>

<!-- ================= SIDEBAR + BANNER ================= -->
<div class="top-wrapper">

    <!-- SIDEBAR -->
    <aside class="sidebar d-none d-lg-block">
        <ul class="category-menu">
            @foreach (var c in categories)
            {
                string icon = "fa-box";
                if (c.CategoryName.Contains("điện thoại", StringComparison.OrdinalIgnoreCase)) icon = "fa-mobile-screen";
                else if (c.CategoryName.Contains("laptop", StringComparison.OrdinalIgnoreCase)) icon = "fa-laptop";
                else if (c.CategoryName.Contains("dụng", StringComparison.OrdinalIgnoreCase)) icon = "fa-screwdriver-wrench";
                else if (c.CategoryName.Contains("phụ kiện", StringComparison.OrdinalIgnoreCase)) icon = "fa-headphones";

                <li>
                    <a asp-controller="Product" asp-action="Index" asp-route-categoryId="@c.CategoryId">
                        <i class="fa-solid @icon icon"></i>
                        <span>@c.CategoryName</span>
                        <i class="fa fa-angle-right arrow"></i>
                    </a>
                </li>
            }
        </ul>
    </aside>

    <!-- BANNER -->
    <div class="banner-grid">
        <div class="banner-main">
            <div id="homeSlider" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
                <div class="carousel-inner">
                    <div class="carousel-item active"><img src="/images/banner/slide1.jpg"></div>
                    <div class="carousel-item"><img src="/images/banner/slide2.jpg"></div>
                    <div class="carousel-item"><img src="/images/banner/slide3.jpg"></div>
                </div>
            </div>
        </div>

        <div class="banner-side d-none d-md-flex flex-column gap-2">
            <img src="/images/banner/side1.jpg">
            <img src="/images/banner/side2.jpg">
        </div>
    </div>
</div>

<!-- ================= CÁC SECTION SẢN PHẨM PHÍA DƯỚI ================= -->
<!-- 👉 GIỮ NGUYÊN TOÀN BỘ PHẦN SỬA ĐIỆN THOẠI / LAPTOP / DỤNG CỤ CỦA BẠN -->
<!-- ================= SỬA ĐIỆN THOẠI ================= -->
        <div class="section-title">SỬA ĐIỆN THOẠI</div>
        <div class="filter-tags" data-section="phone">
            <span class="active" data-filter="all">Tất cả</span>
            <span data-filter="pin">Pin</span>
            <span data-filter="screen">Màn hình</span>
            <span data-filter="camera">Camera</span>
        </div>

        <div class="product-grid">
            @foreach (var p in newProducts.Where(x => x.Category?.CategoryName.Contains("điện", StringComparison.OrdinalIgnoreCase) == true))
            {
                string type = "other";
                if (p.ProductName.Contains("pin", StringComparison.OrdinalIgnoreCase)) type = "pin";
                else if (p.ProductName.Contains("màn", StringComparison.OrdinalIgnoreCase)) type = "screen";
                else if (p.ProductName.Contains("camera", StringComparison.OrdinalIgnoreCase)) type = "camera";

                <div class="product-card filter-item" data-section="phone" data-type="@type">
                    <a asp-controller="Product" asp-action="Details" asp-route-id="@p.ProductId" class="text-decoration-none text-dark">
                        <img src="/images/products/@(p.MainImage ?? "no-image.jpg")">
                        <div class="product-title">@p.ProductName</div>
                    </a>
                    <div class="price">@p.Price.ToString("N0")đ</div>
                </div>
            }
        </div>

        <!-- ================= SỬA LAPTOP ================= -->
        <div class="section-title">SỬA LAPTOP</div>
        <div class="filter-tags" data-section="laptop">
            <span class="active" data-filter="all">Tất cả</span>
            <span data-filter="pin">Pin</span>
            <span data-filter="screen">Màn hình</span>
            <span data-filter="keyboard">Bàn phím</span>
        </div>

        <div class="product-grid">
            @foreach (var p in newProducts.Where(x => x.Category?.CategoryName.Contains("laptop", StringComparison.OrdinalIgnoreCase) == true))
            {
                string type = "other";
                if (p.ProductName.Contains("pin", StringComparison.OrdinalIgnoreCase)) type = "pin";
                else if (p.ProductName.Contains("màn", StringComparison.OrdinalIgnoreCase)) type = "screen";
                else if (p.ProductName.Contains("phím", StringComparison.OrdinalIgnoreCase)) type = "keyboard";

                <div class="product-card filter-item" data-section="laptop" data-type="@type">
                    <a asp-controller="Product" asp-action="Details" asp-route-id="@p.ProductId" class="text-decoration-none text-dark">
                        <img src="/images/products/@(p.MainImage ?? "no-image.jpg")">
                        <div class="product-title">@p.ProductName</div>
                    </a>
                    <div class="price">@p.Price.ToString("N0")đ</div>
                </div>
            }
        </div>

        <!-- ================= DỤNG CỤ SỬA CHỮA ================= -->
        <div class="section-title">DỤNG CỤ SỬA CHỮA</div>

        <div class="filter-tags" data-section="tool">
            <span class="active" data-filter="all">Tất cả</span>
            <span data-filter="hotair">Máy khò</span>
            <span data-filter="solder">Hàn</span>
            <span data-filter="power">Nguồn</span>
            <span data-filter="fan">Quạt</span>
        </div>

        <div class="product-grid">
            @foreach (var p in newProducts.Concat(recommended)
                        .Where(x =>
                        (x.Category?.CategoryName ?? "").Contains("dụng", StringComparison.OrdinalIgnoreCase)
                        || (x.Category?.CategoryName ?? "").Contains("thiết", StringComparison.OrdinalIgnoreCase)
                        || (x.ProductName ?? "").Contains("khò", StringComparison.OrdinalIgnoreCase)
                        || (x.ProductName ?? "").Contains("hàn", StringComparison.OrdinalIgnoreCase)
                        || (x.ProductName ?? "").Contains("nguồn", StringComparison.OrdinalIgnoreCase)
                        || (x.ProductName ?? "").Contains("quạt", StringComparison.OrdinalIgnoreCase)
                        || (x.ProductName ?? "").Contains("tool", StringComparison.OrdinalIgnoreCase)
                        )
                        )
            {
                string type = "other";

                if (p.ProductName.Contains("khò", StringComparison.OrdinalIgnoreCase))
                    type = "hotair";
                else if (p.ProductName.Contains("hàn", StringComparison.OrdinalIgnoreCase))
                    type = "solder";
                else if (p.ProductName.Contains("nguồn", StringComparison.OrdinalIgnoreCase))
                    type = "power";
                else if (p.ProductName.Contains("quạt", StringComparison.OrdinalIgnoreCase))
                    type = "fan";

                <div class="product-card filter-item"
                     data-section="tool"
                     data-type="@type">

                    <a asp-controller="Product"
                       asp-action="Details"
                       asp-route-id="@p.ProductId"
                       class="text-decoration-none text-dark">

                        <img src="/images/products/@(p.MainImage ?? "no-image.jpg")">
                        <div class="product-title">@p.ProductName</div>
                    </a>

                    <div class="price">@p.Price.ToString("N0")đ</div>
                </div>
            }
        </div>



    </div>
</div>

<script>
    document.querySelectorAll(".filter-tags").forEach(group=>{
        const section=group.dataset.section;
        const buttons=group.querySelectorAll("span");
        buttons.forEach(btn=>{
            btn.onclick=()=>{
                buttons.forEach(b=>b.classList.remove("active"));
                btn.classList.add("active");
                const filter=btn.dataset.filter;
                document.querySelectorAll(`.filter-item[data-section='${section}']`)
                .forEach(item=>{
                    item.style.display = filter==="all" || item.dataset.type===filter ? "block":"none";
                });
            }
        });
    });
</script>
