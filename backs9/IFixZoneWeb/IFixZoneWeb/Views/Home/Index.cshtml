@using IFixZoneWeb.Models.Entities
@{
    ViewData["Title"] = "Trang chủ";

    var categories = ViewBag.Categories as List<Category> ?? new();
    var newProducts = ViewBag.NewProducts as List<Product> ?? new();
    var recommended = ViewBag.Recommended as List<Product> ?? new();
    var featured = ViewBag.FeaturedProducts as List<Product> ?? new();
    var allProducts = ViewBag.AllProducts as List<Product> ?? new();
    int phoneCatId = categories.FirstOrDefault(c => c.CategoryName.Contains("điện", StringComparison.OrdinalIgnoreCase))?.CategoryId ?? 0;
    int laptopCatId = categories.FirstOrDefault(c => c.CategoryName.Contains("laptop", StringComparison.OrdinalIgnoreCase))?.CategoryId ?? 0;
    int toolCatId = categories.FirstOrDefault(c => c.CategoryName.Contains("dụng", StringComparison.OrdinalIgnoreCase))?.CategoryId ?? 0;
}


<!-- ===== SIDEBAR + BANNER ===== -->
<div class="top-wrapper">
    <aside class="sidebar d-none d-lg-block">
        <ul class="category-menu">
            @foreach (var c in categories)
            {
                <li>
                    <a asp-controller="Product" asp-action="Index" asp-route-categoryId="@c.CategoryId">
                        <i class="fa fa-box"></i>
                        <span>@c.CategoryName</span>
                        <i class="fa fa-angle-right arrow"></i>
                    </a>
                </li>
            }
        </ul>
    </aside>

    <div class="banner-grid">
        <div class="banner-main">
            <div class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
                <div class="carousel-inner">
                    <div class="carousel-item active"><img src="/images/banner/slide1.jpg"></div>
                    <div class="carousel-item"><img src="/images/banner/slide2.jpg"></div>
                    <div class="carousel-item"><img src="/images/banner/slide3.jpg"></div>
                </div>
            </div>
        </div>
        <div class="banner-side d-none d-md-flex flex-column gap-2">
            <img src="/images/banner/side1.jpg">
            <img src="/images/banner/side2.jpg">
        </div>
    </div>
</div>

<!-- ===== SẢN PHẨM NỔI BẬT ===== -->
@if (featured.Any())
{
    <div class="section-header">
        <div class="section-title">SẢN PHẨM NỔI BẬT</div>
        <a asp-controller="Product" asp-action="Index" class="view-all">Xem tất cả</a>
    </div>

    <div class="featured-wrapper">
        <button class="slide-btn prev"><i class="fa fa-chevron-left"></i></button>
        <div class="featured-track">
            @foreach (var p in featured)
            {
                <div class="featured-item">
                    <a asp-controller="Product" asp-action="Details" asp-route-id="@p.ProductId"
                       class="text-decoration-none text-dark">
                        <img src="/images/products/@(p.MainImage ?? "no-image.jpg")">
                        <div class="featured-name">@p.ProductName</div>
                        <div class="featured-price">@p.Price.ToString("N0")đ</div>
                    </a>
                </div>
            }
        </div>
        <button class="slide-btn next"><i class="fa fa-chevron-right"></i></button>
    </div>
}
<!-- ===== SẢN PHẨM MỚI ===== -->
<div class="section-header">
    <div class="section-title">SẢN PHẨM MỚI</div>
    <a asp-controller="Product" asp-action="Index" class="view-all">Xem tất cả</a>
</div>

<div class="product-grid">
    @foreach (var p in newProducts)
    {
        <div class="product-card">
            <a asp-controller="Product"
               asp-action="Details"
               asp-route-id="@p.ProductId"
               class="text-decoration-none text-dark">

                <img src="/images/products/@(p.MainImage ?? "no-image.jpg")" />
                <div class="product-title">@p.ProductName</div>
            </a>

            <div class="price">@p.Price.ToString("N0")đ</div>
        </div>
    }
</div>

<!-- ===== SỬA ĐIỆN THOẠI ===== -->
<div class="section-header">
    <div class="section-title">SỬA ĐIỆN THOẠI</div>
    <a asp-controller="Product"
       asp-action="Index"
       asp-route-categoryId="@phoneCatId"
       class="view-all">
        Xem tất cả
    </a>
</div>

<div class="filter-tags" data-section="phone">
    <span class="active" data-filter="all">Tất cả</span>
    <span data-filter="pin">Pin</span>
    <span data-filter="screen">Màn hình</span>
    <span data-filter="camera">Camera</span>
    <span data-filter="main">Main / IC</span>
    <span data-filter="loa">Loa</span>
    <span data-filter="rung">Rung</span>
    <span data-filter="sac">Chân sạc</span>
    <span data-filter="nut">Nút</span>
    <span data-filter="sim">SIM</span>
    <span data-filter="mic">Mic</span>
    <span data-filter="day">Cáp</span>
    <span data-filter="vo">Vỏ / Khung</span>
    <span data-filter="khac">Khác</span>
</div>

<div class="product-grid">
    @foreach (var p in allProducts
        .Where(x => x.CategoryId == phoneCatId)
        .Take(10))
    {
        string name = (p.ProductName ?? "").ToLower();
        string type = "khac";

        if (name.Contains("pin")) type = "pin";
        else if (name.Contains("màn") || name.Contains("lcd") || name.Contains("oled")) type = "screen";
        else if (name.Contains("camera") || name.Contains("cam")) type = "camera";
        else if (name.Contains("main") || name.Contains("ic")) type = "main";
        else if (name.Contains("loa")) type = "loa";
        else if (name.Contains("rung")) type = "rung";
        else if (name.Contains("sạc") || name.Contains("chân sạc")) type = "sac";
        else if (name.Contains("nút") || name.Contains("nguồn") || name.Contains("volume")) type = "nut";
        else if (name.Contains("sim")) type = "sim";
        else if (name.Contains("mic")) type = "mic";
        else if (name.Contains("cáp") || name.Contains("dây")) type = "day";
        else if (name.Contains("vỏ") || name.Contains("khung")) type = "vo";

        <div class="product-card filter-item"
             data-section="phone"
             data-type="@type">

            <a asp-controller="Product"
               asp-action="Details"
               asp-route-id="@p.ProductId"
               class="text-decoration-none text-dark">

                <img src="/images/products/@(p.MainImage ?? "no-image.jpg")" />
                <div class="product-title">@p.ProductName</div>
            </a>

            <div class="price">@p.Price.ToString("N0")đ</div>
        </div>
    }
</div>



<!-- ===== SỬA LAPTOP ===== -->
<div class="section-header">
    <div class="section-title">SỬA LAPTOP</div>
    <a asp-controller="Product"
       asp-action="Index"
       asp-route-categoryId="@laptopCatId"
       class="view-all">
        Xem tất cả
    </a>
</div>

<div class="filter-tags" data-section="laptop">
    <span class="active" data-filter="all">Tất cả</span>
    <span data-filter="pin">Pin</span>
    <span data-filter="screen">Màn hình</span>
    <span data-filter="keyboard">Bàn phím</span>
    <span data-filter="fan">Quạt / Tản nhiệt</span>
    <span data-filter="main">Mainboard</span>
    <span data-filter="ram">RAM</span>
    <span data-filter="ssd">SSD / HDD</span>
    <span data-filter="sac">Sạc</span>
    <span data-filter="cap">Cáp</span>
    <span data-filter="loa">Loa</span>
    <span data-filter="wifi">Wifi / BT</span>
    <span data-filter="vo">Vỏ / Khung</span>
    <span data-filter="khac">Khác</span>
</div>

<div class="product-grid">
    @foreach (var p in allProducts
        .Where(x => x.CategoryId == laptopCatId)
        .Take(10))
    {
        string name = (p.ProductName ?? "").ToLower();
        string type = "khac";

        if (name.Contains("pin")) type = "pin";
        else if (name.Contains("màn") || name.Contains("lcd") || name.Contains("oled")) type = "screen";
        else if (name.Contains("phím") || name.Contains("keyboard")) type = "keyboard";
        else if (name.Contains("quạt") || name.Contains("tản")) type = "fan";
        else if (name.Contains("main") || name.Contains("board")) type = "main";
        else if (name.Contains("ram")) type = "ram";
        else if (name.Contains("ssd") || name.Contains("hdd")) type = "ssd";
        else if (name.Contains("sạc") || name.Contains("adapter") || name.Contains("jack")) type = "sac";
        else if (name.Contains("cáp") || name.Contains("cable") || name.Contains("dây")) type = "cap";
        else if (name.Contains("loa")) type = "loa";
        else if (name.Contains("wifi") || name.Contains("bluetooth")) type = "wifi";
        else if (name.Contains("vỏ") || name.Contains("khung")) type = "vo";

        <div class="product-card filter-item"
             data-section="laptop"
             data-type="@type">

            <a asp-controller="Product"
               asp-action="Details"
               asp-route-id="@p.ProductId"
               class="text-decoration-none text-dark">

                <img src="/images/products/@(p.MainImage ?? "no-image.jpg")" />
                <div class="product-title">@p.ProductName</div>
            </a>

            <div class="price">@p.Price.ToString("N0")đ</div>
        </div>
    }
</div>




<!-- ===== DỤNG CỤ SỬA CHỮA ===== -->
<div class="section-header">
    <div class="section-title">DỤNG CỤ SỬA CHỮA</div>
    <a asp-controller="Product"
       asp-action="Index"
       asp-route-categoryId="@toolCatId"
       class="view-all">
        Xem tất cả
    </a>
</div>

<div class="filter-tags" data-section="tool">
    <span class="active" data-filter="all">Tất cả</span>
    <span data-filter="hotair">Máy khò</span>
    <span data-filter="solder">Hàn</span>
    <span data-filter="power">Nguồn</span>
    <span data-filter="multimeter">Đồng hồ đo</span>
    <span data-filter="microscope">Kính hiển vi</span>
    <span data-filter="tweezers">Nhíp</span>
    <span data-filter="screwdriver">Tua vít</span>
    <span data-filter="cable">Cáp / Dây</span>
    <span data-filter="cleaner">Vệ sinh</span>
    <span data-filter="jig">Khuôn / Jig</span>
    <span data-filter="toolset">Bộ dụng cụ</span>
    <span data-filter="khac">Khác</span>
</div>

<div class="product-grid">
    @foreach (var p in allProducts
        .Where(x =>
        (x.Category?.CategoryName ?? "")
        .Contains("dụng", StringComparison.OrdinalIgnoreCase)
        || (x.Category?.CategoryName ?? "")
        .Contains("tool", StringComparison.OrdinalIgnoreCase)
        || (x.Category?.CategoryName ?? "")
        .Contains("thiết bị sửa", StringComparison.OrdinalIgnoreCase)
        )
        .Take(10))
    {
        string name = (p.ProductName ?? "").ToLower();
        string type = "khac";

        if (name.Contains("khò") || name.Contains("hot air")) type = "hotair";
        else if (name.Contains("hàn") || name.Contains("solder")) type = "solder";
        else if (name.Contains("nguồn") || name.Contains("power")) type = "power";
        else if (name.Contains("đồng hồ") || name.Contains("multimeter")) type = "multimeter";
        else if (name.Contains("kính") || name.Contains("microscope")) type = "microscope";
        else if (name.Contains("nhíp") || name.Contains("tweezer")) type = "tweezers";
        else if (name.Contains("tua vít") || name.Contains("screwdriver")) type = "screwdriver";
        else if (name.Contains("cáp") || name.Contains("dây") || name.Contains("cable")) type = "cable";
        else if (name.Contains("cồn") || name.Contains("vệ sinh") || name.Contains("clean")) type = "cleaner";
        else if (name.Contains("jig") || name.Contains("khuôn")) type = "jig";
        else if (name.Contains("bộ") || name.Contains("toolkit")) type = "toolset";

        <div class="product-card filter-item"
             data-section="tool"
             data-type="@type">

            <a asp-controller="Product"
               asp-action="Details"
               asp-route-id="@p.ProductId"
               class="text-decoration-none text-dark">

                <img src="/images/products/@(p.MainImage ?? "no-image.jpg")" />
                <div class="product-title">@p.ProductName</div>
            </a>

            <div class="price">@p.Price.ToString("N0")đ</div>
        </div>
    }
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const track = document.querySelector(".featured-track");
        if (!track) return;

        const prev = document.querySelector(".slide-btn.prev");
        const next = document.querySelector(".slide-btn.next");

        let step = 0;
        let auto;

        function calcStep() {
            const item = track.querySelector(".featured-item");
            if (!item) return;
            step = item.getBoundingClientRect().width + 16;
        }

        function nextSlide() {
            if (step === 0) calcStep();
            track.scrollLeft += step;

            if (track.scrollLeft + track.clientWidth >= track.scrollWidth - step) {
                track.scrollLeft = 0;
            }
        }

        // ⏳ ĐỢI ẢNH LOAD XONG
        window.addEventListener("load", () => {
            calcStep();
            auto = setInterval(nextSlide, 3000);
        });

        next?.addEventListener("click", nextSlide);

        prev?.addEventListener("click", () => {
            if (step === 0) calcStep();
            if (track.scrollLeft <= 0) {
                track.scrollLeft = track.scrollWidth;
            }
            track.scrollLeft -= step;
        });

        track.addEventListener("mouseenter", () => clearInterval(auto));
        track.addEventListener("mouseleave", () => {
            auto = setInterval(nextSlide, 3000);
        });
    });
     /* ===== FILTER ===== */
    document.querySelectorAll(".filter-tags").forEach(group=>{
        const section=group.dataset.section;
        group.querySelectorAll("span").forEach(btn=>{
            btn.onclick=()=>{
                group.querySelectorAll("span").forEach(b=>b.classList.remove("active"));
                btn.classList.add("active");
                const f=btn.dataset.filter;
                document.querySelectorAll(`.filter-item[data-section='${section}']`)
                    .forEach(i=>i.style.display=(f==="all"||i.dataset.type===f)?"block":"none");
            }
        });
    });

</script>

<style>
    /* ===== TOP WRAPPER ===== */
    .top-wrapper {
        display: grid;
        grid-template-columns: 240px 1fr;
        gap: 16px;
        background: #fff;
        border-radius: 14px;
        padding: 12px;
        border: 1px solid #eee;
        margin-bottom: 24px;
    }

    @@media(max - width:992px) {
        .top-wrapper {
            grid-template-columns: 1fr;
        }
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
        border-radius: 12px;
        overflow: hidden;
    }

    .category-menu {
        list-style: none;
        padding: 0;
        margin: 0;
    }

        .category-menu li {
            border-bottom: 1px solid #f1f1f1;
        }

        .category-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            font-size: 15px;
            font-weight: 500;
            color: #111;
            text-decoration: none;
            transition: .25s;
        }

            .category-menu a:hover {
                background: #f5f7fa;
                color: #d70018;
            }

        .category-menu i.arrow {
            margin-left: auto;
            color: #9ca3af
        }

    /* ===== BANNER ===== */
    .banner-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 12px;
    }

    @@media(max - width:768px) {
        .banner-grid {
            grid-template-columns: 1fr;
        }
    }

    .banner-main, .banner-side {
        border-radius: 12px;
        overflow: hidden;
    }

        .banner-main img, .banner-side img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

    /* ===== SECTION HEADER ===== */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 32px 0 16px;
    }

    .section-title {
        font-size: 22px;
        font-weight: 800;
        border-left: 5px solid #d70018;
        padding-left: 12px;
    }

    .view-all {
        font-size: 14px;
        font-weight: 600;
        color: #d70018;
        text-decoration: none;
    }

        .view-all:hover {
            text-decoration: underline
        }

    /* ===== FEATURED SLIDER ===== */
    .featured-wrapper {
        position: relative;
        background: #fff;
        border-radius: 14px;
        border: 1px solid #eee;
        padding: 16px 40px;
        overflow: hidden;
    }

    .featured-track {
        display: flex;
        gap: 16px;
        overflow-x: auto;
        scroll-behavior: smooth;
        scrollbar-width: none;
    }

        .featured-track::-webkit-scrollbar {
            display: none
        }

    .featured-item {
        min-width: 200px;
        border: 1px solid #eee;
        border-radius: 12px;
        padding: 12px;
        transition: .25s;
    }

        .featured-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(0,0,0,.12);
        }

        .featured-item img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: contain;
        }

    .featured-name {
        font-size: 14px;
        font-weight: 600;
        height: 36px;
        overflow: hidden;
        margin: 8px 0;
    }

    .featured-price {
        color: #d70018;
        font-weight: 800;
    }

    .slide-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #fff;
        border: 1px solid #ddd;
        cursor: pointer;
    }

        .slide-btn.prev {
            left: 8px
        }

        .slide-btn.next {
            right: 8px
        }

    /* ===== FILTER ===== */
    .filter-tags {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
    }

        .filter-tags span {
            padding: 6px 12px;
            border-radius: 8px;
            background: #f1f3f5;
            cursor: pointer;
            font-size: 13px;
        }

            .filter-tags span.active,
            .filter-tags span:hover {
                background: #d70018;
                color: #fff
            }

    /* ===== PRODUCT GRID ===== */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(5,1fr);
        gap: 16px;
    }

    @@media(max - width:1200px) {
        .product-grid {
            grid-template-columns: repeat(4,1fr)
        }
    }

    @@media(max - width:768px) {
        .product-grid {
            grid-template-columns: repeat(2,1fr)
        }
    }

    .product-card {
        background: #fff;
        border-radius: 14px;
        border: 1px solid #eee;
        padding: 12px;
        transition: .25s;
    }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(0,0,0,.12);
        }

        .product-card img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: contain;
        }

    .product-title {
        font-size: 14px;
        font-weight: 600;
        height: 40px;
        overflow: hidden;
        margin: 10px 0;
    }

    .price {
        color: #d70018;
        font-size: 18px;
        font-weight: 800;
    }
</style>
